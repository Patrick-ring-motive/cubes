<svg width="600" height="600" viewBox="-200 -200 900 900" xmlns="http://www.w3.org/2000/svg">
  <style>
    .face {
      stroke: none;
      cursor: pointer;
    }
  </style>

  <defs id="filters">
    <filter id="grain">
      <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" result="noise"/>
      <feColorMatrix in="noise" type="saturate" values="0" result="desaturatedNoise"/>
      <feComponentTransfer in="desaturatedNoise" result="theNoise">
        <feFuncA type="table" tableValues="0 0 0.05 0"/>
      </feComponentTransfer>
      <feBlend in="SourceGraphic" in2="theNoise" mode="multiply"/>
    </filter>
  </defs>

  <script type="application/ecmascript"><![CDATA[
    const svgNS = "http://www.w3.org/2000/svg";
    const defs = document.getElementById("filters");
    const svg = document.currentScript.parentNode;

    const size = 5;
    const tileW = 64;
    const tileH = 24; // Reduced for dimetric
    const originX = 300;
    const originY = 100;
    const levelHeight = 40;

    // Dimetric projection angles (7:42:42 ratio)
    const xScale = 0.935; // Right axis scaling
    const yScale = 0.935; // Left axis scaling

    function createFaceFilter(x, y, z, brightness) {
      const filter = document.createElementNS(svgNS,"filter");
      const id = `f-${x}-${y}-${z}-${brightness}`;
      filter.setAttribute("id", id);

      // Base color flood
      const flood = document.createElementNS(svgNS,"feFlood");
      flood.setAttribute("flood-color","#8fb3a2");
      flood.setAttribute("result","baseColor");
      filter.appendChild(flood);

      const composite1 = document.createElementNS(svgNS,"feComposite");
      composite1.setAttribute("in","baseColor");
      composite1.setAttribute("in2","SourceAlpha");
      composite1.setAttribute("operator","in");
      composite1.setAttribute("result","coloredShape");
      filter.appendChild(composite1);

      const sat = document.createElementNS(svgNS,"feColorMatrix");
      sat.setAttribute("in","coloredShape");
      sat.setAttribute("type","saturate");
      sat.setAttribute("values", (1 + x*0.05).toFixed(3));
      sat.setAttribute("result","saturated");
      filter.appendChild(sat);

      const contrast = document.createElementNS(svgNS,"feComponentTransfer");
      contrast.setAttribute("in","saturated");
      contrast.setAttribute("result","contrasted");
      ['R','G','B'].forEach(c=>{
        const func = document.createElementNS(svgNS,"feFunc"+c);
        func.setAttribute("type","linear");
        func.setAttribute("slope",(1 + y*0.05).toFixed(3));
        contrast.appendChild(func);
      });
      filter.appendChild(contrast);

      const hue = document.createElementNS(svgNS,"feColorMatrix");
      hue.setAttribute("in","contrasted");
      hue.setAttribute("type","hueRotate");
      hue.setAttribute("values",(z*10).toFixed(1));
      hue.setAttribute("result","hued");
      filter.appendChild(hue);

      const bright = document.createElementNS(svgNS,"feComponentTransfer");
      bright.setAttribute("in","hued");
      bright.setAttribute("result","brightened");
      for(const c of ['R','G','B']){
        const func = document.createElementNS(svgNS,"feFunc"+c);
        func.setAttribute("type","linear");
        func.setAttribute("slope",brightness.toFixed(3));
        bright.appendChild(func);
      };
      filter.appendChild(bright);

      // Add grain
      const turbulence = document.createElementNS(svgNS,"feTurbulence");
      turbulence.setAttribute("type","fractalNoise");
      turbulence.setAttribute("baseFrequency","1.2");
      turbulence.setAttribute("numOctaves","5");
      turbulence.setAttribute("result","noise");
      filter.appendChild(turbulence);

      const colorMatrix = document.createElementNS(svgNS,"feColorMatrix");
      colorMatrix.setAttribute("in","noise");
      colorMatrix.setAttribute("type","saturate");
      colorMatrix.setAttribute("values","0");
      colorMatrix.setAttribute("result","desaturatedNoise");
      filter.appendChild(colorMatrix);

      const componentTransfer = document.createElementNS(svgNS,"feComponentTransfer");
      componentTransfer.setAttribute("in","desaturatedNoise");
      componentTransfer.setAttribute("result","theNoise");
      const funcA = document.createElementNS(svgNS,"feFuncA");
      funcA.setAttribute("type","table");
      funcA.setAttribute("tableValues","0 0 0.15 0");
      componentTransfer.appendChild(funcA);
      filter.appendChild(componentTransfer);

      const blend = document.createElementNS(svgNS,"feBlend");
      blend.setAttribute("in","brightened");
      blend.setAttribute("in2","theNoise");
      blend.setAttribute("mode","multiply");
      filter.appendChild(blend);

      defs.appendChild(filter);
      return id;
    }

    for(let z=0; z!==size; ++z){
      for(let y=0; y!==size; ++y){
        for(let x=0; x!==size; ++x){
          const sx = (originX + x*(tileW*xScale) - y*(tileW*yScale));
          const sy = (originY + x*(tileH*xScale) + y*(tileH*yScale) - z*levelHeight);

          const g = document.createElementNS(svgNS,"g");
          g.setAttribute("transform", `translate(${sx},${sy})`);

          // Dimetric tile dimensions
          const w = tileW * xScale;
          const h = tileH * yScale;
          const vHeight = levelHeight;

          // Top face (parallelogram)
          const top = document.createElementNS(svgNS,"polygon");
          top.setAttribute("points",`${w} 0, ${w*2} ${h}, ${w} ${h*2}, 0 ${h}`);
          top.setAttribute("class","face");
          const fTop = createFaceFilter(x,y,z,1.15);
          top.setAttribute("filter",`url(#${fTop})`);
          g.appendChild(top);

          // Left face
          const left = document.createElementNS(svgNS,"polygon");
          left.setAttribute("points",`0 ${h}, ${w} ${h*2}, ${w} ${h*2+vHeight}, 0 ${h+vHeight}`);
          left.setAttribute("class","face");
          const fLeft = createFaceFilter(x,y,z,0.95);
          left.setAttribute("filter",`url(#${fLeft})`);
          g.appendChild(left);

          // Right face
          const right = document.createElementNS(svgNS,"polygon");
          right.setAttribute("points",`${w*2} ${h}, ${w} ${h*2}, ${w} ${h*2+vHeight}, ${w*2} ${h+vHeight}`);
          right.setAttribute("class","face");
          const fRight = createFaceFilter(x,y,z,0.8);
          right.setAttribute("filter",`url(#${fRight})`);
          g.appendChild(right);

          g.addEventListener("click",()=>g.remove());

          svg.appendChild(g);
        }
      }
    }
  ]]></script>

</svg>
